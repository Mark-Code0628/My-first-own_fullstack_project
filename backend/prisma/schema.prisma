// --- datasource
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- generator
generator client {
  provider = "prisma-client-js"
}

model Vendor {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  name          String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  calendar      Calendar?
}

model Calendar {
  id        String   @id @default(uuid())
  slug      String   @unique
  vendorId  String   @unique
  createdAt DateTime @default(now())

  vendor    Vendor   @relation(fields: [vendorId], references: [id])
  services  Service[]
  bookings  Booking[]
}

model Service {
  id          String   @id @default(uuid())
  calendarId  String
  name        String
  durationMin Int
  price       Int?
  createdAt   DateTime @default(now())

  calendar    Calendar @relation(fields: [calendarId], references: [id])
  bookings    Booking[]  // <-- inverse relation
}

model Booking {
  id          String   @id @default(uuid())
  calendarId  String
  serviceId   String
  customerName  String
  customerEmail String
  startTime   DateTime
  endTime     DateTime
  createdAt   DateTime @default(now())
  
  calendar    Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)


  @@index([calendarId, startTime, endTime])
}
